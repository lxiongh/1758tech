---
title: 货架物品的分割
date: 2014-04-18
tags:
  - Image
  - Segment
---

## 写在前面

此文章原来是更新在我的博客园里，为了方便查阅，现将文章都统一搬运到 Coding.net 网站上。下面是我给大家带来的博文是关于货架物品的分割与识别，这里我只给大家分享货架物品的分割过程，因为识别这一块是由一个师兄完成的。总体方案流程图：

<!--more-->

{% asset_img fw.png framework %}

## 项目要求

对货架物品的识别与定位，如下图，我们需要识别出不同的商品，同时知道相应商品的摆放位置。经过讨论，我们将此问题分解成两个子问题——分割与识别。其中分割由我来完成，识别任务交于师兄完成。

{% asset_img task.jpg task %}

## 过程与方法

任务简述: 我们需要将不同的物品分割开，需要满足如下两点要求，1.分割块（patch）有且仅包含一种商品；2. 同一种商品可以被分割成不同的块（patch），只要满足后续的物品识别要求。

分割过程: 注意到货架的特殊性，我们可以先对图片进行行分割，然后对每个行分割后的图片再进行列分割，最后得到用于物品识别的分割块（patch）。

### 实施方法

#### 行分割

- 方案1. 沿着竖直方向，对所有红色框内的pixels进行直方图统计，用相邻两个框内的直方图欧氏距离衡量差异，得到一个差异曲线。曲线的最低点为行分割线所外的位置。

{% asset_img plan1a.png plan1a %}
{% asset_img plan1b.png plan1b %}

- 方案2. 在实验过程中，采用方案1的分割线经常会将物品分割开，如上图中的黄色行分割线所示。于是我们的最后实验中，采用了方案2作为行分割的方法。
和传统的直线检测算法一样，我们先从图像中检测边缘像素，然后从这些边缘像素中分析可能存在的直线．传统的边缘检测算法，例如Canny算子，不能很好的找到所需要的边界点．

{% asset_img plan2a.png plan2a %}

虽然可以调整不同参数得到不同的检测结果，但是上图所示，不同参数或者导致过多与目标直线无关的边缘被检测到，或者导致一些和目标直线相关的重要边缘丢失．

{% asset_img seg.jpg segment %}


注意到图像分割算法提供了很好的图像边缘，如上图所示．因此我们以图像分割后不同块之间的边界像素为初始条件来进行直线检测，采用[Efficient Graph-based image segmentation](http://www.cs.brown.edu/~pff/segment/)．当然图像分割结果也和参数选取有关系，我们采用比较保守的参数，使得尽可能找到所有和目标直线相关的边缘像素，我们只保留水平的边缘像素。随后腐蚀膨胀，再采用radon直线检测算法进行直线的检测，直线角度限定在-5~+5度，行分割结果下图所示。

{% asset_img row-seg.jpg segment %}


#### 列分割

采用的方法与行分割类似，通过对比发现，直方图统计时，采用HSV空间的H通道得到的效果较为理想，如图6所示。 不同窗口间的差异反应了色调的变化差异，当差异达到最大时，表明此处可能是不同类别的物品的列分割线。我们将窗口间的差异通过三次样条插值拟合的方式，拟合成一条样条曲线，其中极大值处为可能的列分割线，后经过一些细节上的处理，得到下图所示的行列分割结果。


{% asset_img diff.png different %}
{% asset_img result.png final result %}
